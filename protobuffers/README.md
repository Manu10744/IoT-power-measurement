# Protocol Buffers
This directory contains the protocol buffers that are used for communication between the ESP32 power measurement node, the edge devices and the prometheus exporter.

The code is generated by [protobuf-c](https://github.com/protobuf-c/protobuf-c).

### Usage

#### Generate output files
```bash
# This will generate powermeasurement.pb-c.c and powermeasurement.pb-c.h
protoc --c_out=. powermeasurement.proto
```

#### Include
- Include header
```C
#include "path/to/powermeasurement.pb-c.h"
[...]
```

- Include associated `.c` file during compilation
```bash
gcc [...] ${PROTOBUFS_DIR}/powermeasurements/powermeasurement.pb-c.c [...]
```

#

### Troubleshooting
- `error while loading shared libraries: libprotobuf.so.1: cannot open shared object file: No such file or directory`:<br>
Install libprotobuf-c
```bash
wget https://mirrors.kernel.org/ubuntu/pool/universe/p/protobuf-c/libprotobuf-c1_1.2.1-2_amd64.deb
sudo apt install ./libprotobuf-c1_1.2.1-2_amd64.deb
```